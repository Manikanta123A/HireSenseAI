{% extends 'admins/adminbase.html' %}

{% block title %}DevOrks - Job Form{% endblock %}

{% block head_extra %}
  <style>
    /* ... (Your existing CSS remains here) ... */
   .form-card {
  max-width: 850px;
  margin: 60px auto;
  padding: 40px;
  background: #0f172a;                /* Dark base */
  border: 1px solid #1e293b;
  border-radius: 14px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.45);
}

/* Title */
.form-card h2 {
  text-align: center;
  margin-bottom: 40px;
  font-size: 2.5rem;
  color: #38bdf8;
  letter-spacing: 1px;
}

/* Labels */
.form-card label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  font-size: 0.9rem;
  color: #cbd5e1;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Inputs */

/* Focus state */
.form-card input:focus,
.form-card textarea:focus,
.form-card select:focus {
  outline: none;
  border-color: #38bdf8;
  background-color: #243248;
  box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.25);
}

/* Textarea */
.form-card textarea {
  resize: vertical;
  min-height: 120px;
}

/* Button */
.btn {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color: white;
  padding: 14px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  width: 100%;
  margin-top: 20px;
  transition: all 0.2s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
}

/* Optional: fieldset styling if used */
.assessment-builder-fieldset {
  border: 1px solid #334155;
  border-radius: 10px;
  padding: 20px;
  margin: 25px 0;
  background-color: #111827;
}

.assessment-builder-fieldset legend {
  color: #38bdf8;
  font-weight: 600;
}


.form-card input,
.form-card textarea,
.form-card select {
  width: 100%;
  padding: 14px 16px;
  margin-bottom: 25px;
  border: 1px solid #334155;
  border-radius: 10px;
  background-color: #1e293b;
  color: #e2e8f0;
  font-size: 1rem !important;
  box-sizing: border-box;
  transition: all 0.2s ease;
}

.form-card input::placeholder,
.form-card textarea::placeholder {
  color: #94a3b8;
}


  </style>
{% endblock %}

{% block content %}
  <div class="form-card">
    <h2 id="formTitle">Post a New Job</h2>
    <form id="jobForm">
      <label for="jobDescription">Job Description:</label>
      <textarea id="jobDescription" rows="6" required></textarea>

      <label for="qualifications">Qualifications:</label>
      <textarea id="qualifications" rows="4" required></textarea>

      <label for="responsibilities">Role:</label>
      <textarea id="responsibilities" rows="4" required></textarea>

      

      <label for="requiredExperience">Required Experience:</label>
      <input type="text" id="requiredExperience" placeholder="e.g., 2+ years, 5-7 years" required />

      <label for="nop">Number Of Positions :</label>
      <input type="number" id="nop" placeholder="e.g. 1,2,3,4" required min="1" />

      <!-- NEW FIELD: Deadline Date -->
      <label for="deadline">Deadline : <span class="required">*</span></label>
      <input type="datetime-local" id="deadline" name="deadline" required>

      <button type="submit" class="btn btn-primary">Post Job</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const deadlineInput = document.getElementById('deadline');

      const now = new Date();
      const tomorrow = new Date(now); 
      tomorrow.setDate(now.getDate() + 1);
      const nowIso = new Date(tomorrow.getTime() - (tomorrow.getTimezoneOffset() * 60000)).toISOString().slice(0, 16);
      deadlineInput.setAttribute('min', nowIso);
      const company_name = localStorage.getItem('company_name'); // Assuming this is where the job title comes from, based on your original formData.append('jobTitle', company_name);

      

      document.getElementById('jobForm').addEventListener('submit', async function (event) {
      event.preventDefault();

        const formData = new FormData();
        formData.append('jobTitle', company_name); // Assuming company_name is intended as jobTitle
        formData.append('jobDescription', document.getElementById('jobDescription').value.trim());
        formData.append('qualifications', document.getElementById('qualifications').value.trim());
        formData.append('responsibilities', document.getElementById('responsibilities').value.trim());
        formData.append('requiredExperience', document.getElementById('requiredExperience').value.trim());
        formData.append('number_of_positions', document.getElementById('nop').value);
        formData.append('deadline', document.getElementById('deadline').value); // Send the deadline
        try {

          
          navigator.sendBeacon('/jobs', formData  );

          window.location.href = "/admin/applications";
          // const result = await response.json();
          // console.log("result")
          

          // if (response.ok) {
          //   // Check if showGlobalMessage function exists
          //   if (typeof showGlobalMessage === 'function') {
          //     showGlobalMessage(result.message, 'success', '/admin/job');
          //   } else {
          //     alert('Job posted successfully!');
          //     window.location.href = '/admin/job';
          //   }
            
           
          // } else {
          //   if (typeof showGlobalMessage === 'function') {
          //     showGlobalMessage(result.message || 'Failed to post job', 'error');
          //   } else {
          //     alert(result.message || 'Failed to post job. Please try again.');
          //   }
          // }
        } catch (error) {
          console.error('Error submitting job form:', error);
          if (typeof showGlobalMessage === 'function') {
            showGlobalMessage('Failed to submit job. Please try again.', 'error');
          } else {
            alert('Failed to submit job. Please try again.');
          }
        }
      });


    });
  </script>
{% endblock %}